<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot password - AV Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div class="ls-page-wrapper">
        <div class="ls-dual-container">
            <!-- Left Column - Logo & Text Section -->
            <div class="ls-visual-section">
                <div class="ls-visual-bg-animation"></div>
                <div class="ls-floating-elements">
                    <div class="ls-floating-shape"></div>
                    <div class="ls-floating-shape"></div>
                    <div class="ls-floating-shape"></div>
                </div>
                <div class="ls-logo-wrapper">
                    <div class="ls-company-logo">
                       <img src="assets/img/logo.png" width="220" alt="">
                    </div>
                </div>
                <div class="ls-brand-content">
                    <!-- <h2 class="ls-brand-title">MANAGEMENT SOLUTION</h2> -->
                    <p class="ls-brand-description">Streamline your business operations with our comprehensive legal and financial management platform. Trusted by thousands of professionals worldwide.</p>
                    <ul class="ls-feature-list">
                        <li class="ls-feature-item">
                            <i class="bi bi-check-circle-fill ls-feature-icon"></i>
                            Secure & Reliable
                        </li>
                        <li class="ls-feature-item">
                            <i class="bi bi-check-circle-fill ls-feature-icon"></i>
                            Easy to Use Interface
                        </li>
                        <li class="ls-feature-item">
                            <i class="bi bi-check-circle-fill ls-feature-icon"></i>
                            24/7 Customer Support
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Right Column - Login Form Section -->
            <div class="ls-content-section">
                <div class="ls-form-header">
                    <div class="ls-section-badge">
                        <i class="bi bi-shield-check"></i>
                        Secure
                    </div>
                    <h2 class="ls-section-title">Forgot your password?</h2>
                    <p class="ls-section-description">Enter your email and weâ€™ll send you a reset link.</p>
                </div>

                <form class="ls-login-form" id="forgotPasswordForm">
                    <div class="ls-input-wrapper">
                        <label for="email" class="ls-input-label">Enter Email</label>
                        <div style="position: relative;">
                            <input type="email" id="email" class="ls-input-field" placeholder="your@email.com" required>
                            <i class="bi bi-envelope-fill ls-input-icon"></i>
                        </div>
                    </div>
                    
                    <!-- Form error to show -->
                    <div id="formError" style="display: none;">
                    </div>

                    <!-- Submit button -->
                    <button type="submit" class="ls-submit-button" id="resetLinkBtn">
                        Send rest link
                    </button>
                </form>

                <div class="ls-form-footer">
                    <a href="/login.html" class="ls-footer-link">Back to login</a>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/api.js"></script>
    <script>
        // Check if 'accessToken' exists in localStorage and 'userData' exists in sessionStorage
        const accessToken = localStorage.getItem('accessToken');
        // const userData = sessionStorage.getItem('userData');
        const userData = localStorage.getItem('userData');

        // If both exists, redirect to dashboard page
        if (accessToken && userData) {
            window.location.href = '/admin';
        }

        const formError = document.getElementById("formError");

        // Login Functionality
        document.getElementById("forgotPasswordForm").addEventListener("submit", async function(e) {
            e.preventDefault();
            formError.style.display = 'none';

            const email = document.getElementById("email").value.trim();

            if (!email) {
                console.log("Please enter your email");
                return;
            }

            if (!validateEmail(email)) {
                formError.innerHTML = `<span>Please provide a valid Email.</span>`;
                formError.style.display = 'flex';
                return;
            }
            
            setLoading(true);

            try {
                const result = await forgetPassword({ 
                    "email": email,
                });

                console.log(result);
                if (result == "API failed") {
                    setLoading(false);
                    throw new Error(result);
                }

                if (result.status !== 200) {
                    formError.innerHTML = `<span>${result.message}</span>`;
                    formError.style.display = 'flex';
                    setLoading(false);
                    return;
                }

                formError.innerHTML = `<span style="color: green;">${result.message}</span>`;
                formError.style.display = 'flex';
            } catch (error) {
                console.error("Login error:", error);
                formError.innerHTML = `<span>Something went wrong. Please try again.</span>`;
                formError.style.display = 'flex';
            }

            setLoading(false);
        });

        // set loader on form submit
        function setLoading(isLoading) {
            const loginBtn = document.getElementById('resetLinkBtn');

            if (isLoading) {
                loginBtn.disabled = true;
                loginBtn.innerHTML = `
                    <span class="spinner-border spinner-border-sm me-2"></span>
                    Sending...
                `;
            } else {
                loginBtn.disabled = false;
                loginBtn.innerHTML = 'Send rest link';
            }
        }

        // Email validation
        function validateEmail(email) {
            const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            return regex.test(email);
        }
    </script>
</body>
</html>
